!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(a,b){var c=a.getDay(),d=(b.getDay(),b.intervalByDate(a)),e=0,f=c;return 0!=f&&(e++,f=0,d-=7-f),e+=Math.gauce(d/7)}function c(a,b){var c=d(a,b),f=(e(a,b,c),e(a,b,1)),g=0,h=f;0==f?h=7:g++;var i=c-(7-h);return g+=Math.gauce(i/7)}function d(a,b){return new Date(a,b,0).getDate()}function e(a,b,c){return new Date(a,b-1,c).getDay()}function f(c,d,e,f,g){var h=f.intervalByDate(e),j=h>=7?7:h;if(0>=h)return null;d.empty(),d.addClass("sylendar-root").addClass("unselectable"),d.attr("start",i(e)),d.attr("end",i(f));var k=b(e,f),l=100/k,m=a("<div>").addClass("border-line").addClass("top");d.append(m);for(var n=["일","월","화","수","목","금","토"],o=0;7>o;o++){var p=a("<div>").addClass("cell").addClass("indexer");m.append(p),0==o&&p.addClass("sunday"),6==o&&p.addClass("saturday"),p.text(n[o])}var q=a("<div />").addClass("border-line").addClass("bottom");d.append(q);var r=a("<div>").addClass("template-board");q.append(r);var s=a("<div>").addClass("event-board");q.append(s);for(var t=0,u=0,v=new Date(e);f>v;){var w=a("<div />").addClass("row"),x=a("<div />").addClass("row"),y=(a("<div />").addClass("row-table").addClass("event-table").css("position","relative"),new Date(v)),z=new Date(y);z.setDate(z.getDate()+j-1);for(var A=new Date(v),o=0;j>o;o++){var B=a("<div />").addClass("cell").addClass("border-line").addClass("template-cell"),C=v.getDate();1===v.getDate()&&(C=v.getMonth()+1+"."+C,0===v.getMonth()&&(C=v.getFullYear()+"."+C)),B.text(C),w.append(B),i(v)===i(new Date)&&B.addClass("today"),B.attr("date",i(v)),v.setDate(v.getDate()+1)}var A=i(A),D=i(v);x.attr("start",A),x.attr("end",D),w.css("top",t+"%");var E=l;w.css("height",E+"%"),t+=l,x.css("top",u+"%"),x.css("height",l+"%"),u+=l,r.append(w),s.append(x)}return a("html").on("mousemove",function(){}),d}Math.gauce=function(a){var b=Math.floor(a),c=a-b;return b+(0==c?0:1)},Date.prototype.yyyymmdd=function(a){arguments[0]="undefined"==typeof arguments[0]?"":arguments[0];var b=this.getFullYear().toString(),c=(this.getMonth()+1).toString(),d=this.getDate().toString(),e=arguments.length,f="",g=0;return f+=b+arguments[g],g=g+1>=e?g:g+1,f+=(c[1]?c:"0"+c[0])+arguments[g],g=g+1>=e?g:g+1,f+=d[1]?d:"0"+d[0],0!=g&&(f+=arguments[g]),f},Date.prototype.yyyymm=function(a){a="undefined"==typeof a?"":a;var b=this.getFullYear().toString(),c=(this.getMonth()+1).toString();return b+a+(c[1]?c:"0"+c[0])},Date.prototype.mmdd=function(a){a="undefined"==typeof a?"":a;var b=(this.getMonth()+1).toString(),c=this.getDate().toString();return(b[1]?b:"0"+b[0])+a+(c[1]?c:"0"+c[0])},String.prototype.date=function(a){var b=new String(this);if("undefined"==typeof a){var c=(new Date).getFullYear().toString()[0]==b[0]&&b.length>4?[4,2,2]:b.length>2?[2,2]:[2];console.log((new Date).getFullYear().toString()[0]);var d=0;b=_.map(c,function(a){var c=b.substr(d,a);return d+=a,c}),a="-",b=b.join("-")}var e=b.split(a);return 1==e.length&&(e=[(new Date).getMonth()+1].concat(e)),2==e.length&&(e=[(new Date).getFullYear()].concat(e)),e.length>1&&e[1]--,new(Date.bind.apply(Date,[null].concat(e)))},Date.prototype.intervalByDate=function(a){var b=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0),c=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0);return Math.floor(Math.abs(b.getTime()-c.getTime())/1e3/60/60/24)},Date.prototype.addByDate=function(a){return this.setDate(this.getDate()+a),this},Date.prototype.subByDate=function(a){return this.setDate(this.getDate()-a),this},Date.prototype.cutTimes=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this};var g=0,h={YEAR:"year",MONTH:"month",WEEK:"week",DAY:"day"},i=function(a){return a.yyyymmdd("-")},j=function(a){return a.toDate("-")},k=function(){return g++},l=function(a,b){var c="";for(var d in b){var e=b[d];c+="["+e.name+e.comparison+"'"+e.value+"']"}return"."+a+c},m=function(){return{}};a.fn.sylendarObject=function(){var b=[],c={};return{getTarget:function(){return null},getColumnCount:function(){return 0},getRowCount:function(){return 0},getEventTemplate:function(){return null},getEllipsisTemplate:function(){return null},insertEvent:function(a,c,d,e){var f=(this.getTarget(),k());e=_.extend({redraw:!0,single:!1},e);var g={id:f,start:a,end:c,single:e.single};return b.push(_.extend(g,d)),b=this.sortEvents(b),e.redraw&&this.render(),_.extend(new m,{id:f,$el:this.getEventEl(f)})},deleteEvent:function(a,c){var c=_.extend({redraw:!0},c);b=_.without(b,_.findWhere(b,{id:a})),c.redraw&&this.render(this)},getEventEl:function(a){var b=this.getTarget();return b.find(l("event",[{name:"event-id",comparison:"=",value:a}]))},getEvent:function(a){return _.findWhere(b,{id:a})},getEllipsisEl:function(a){if("number"==typeof a)return this.getTarget().find(l("ellipsis",[{name:"cell-index",comparison:"=",value:a}]));if("object"==typeof a){var b=a.attr("cell-index");return this.getTarget().find(l("ellipsis",[{name:"cell-index",comparison:"=",value:b}]))}return null},toggleSingleEvent:function(a){var b=this.getEvent(a);return b.single=!b.single,this.render(),b.single},setEventSingle:function(a){var b=this.getEvent(a);b.single||(b.single=!0,this.render())},setEventNonSingle:function(a){var b=this.getEvent(a);b.single&&(b.single=!1,this.render())},sortEvents:function(a){return a=_.sortBy(a,function(a){return a.summary}).reverse(),a=_.sortBy(a,function(a){return a.end.yyyymmdd()}).reverse(),a=_.sortBy(a,function(a){return a.start.yyyymmdd()})},render:function(){console.log("render");var d=this.getTarget(),e=j(d.attr("start")),f=j(d.attr("end")),g=new Date,h=_.cloneDeep(b);_.each(h,function(a){a.isStart=!0,a.isEnd=!1,a.isSliced=!1,a.isExpired=!1,a.origStart=a.start,a.origEnd=a.end,a.start<g&&a.end<g&&(a.isExpired=!0)}),h=_.filter(h,function(a){return i(a.start)<i(e)&&a.single?!1:i(a.start)<i(e)&&i(a.end)<=i(e)?!1:i(a.start)>=i(f)&&i(a.end)>i(f)?!1:!0}),_.each(h,function(a){i(a.start)<i(e),i(a.end)>i(f)&&(a.end=new Date(f))}),d.find(".event").remove(),c={};var k=14.28571428571429;7!=this.getColumnCount()&&(k=100/this.getColumnCount()),_.each(d.find(".event-board .row"),function(b,d){var e=a(b).height()-21,f=a("<div>").addClass("event").hide();a(b).append(f);var g=f.height()+2;f.remove();var l=(Math.floor(e/g),j(a(b).attr("start"))),m=j(a(b).attr("end")),n=(new Date(l),{}),o=0,p=d*this.getColumnCount();if(h.length>0)for(;i(h[0].start)<i(m)&&i(h[0].start)>=i(l);){var q=h[0];if(h.shift(),!q.single)if(i(q.end)>i(m)){var r=_.clone(q);q.isSliced=!0,r.isSliced=!0,r.isStart=!1,q.end=new Date(m),r.start=new Date(m),h.push(r),h=this.sortEvents(h)}else q.isEnd=!0;var s=q.start.subToDayCount(l),t=q.end.subToDayCount(q.start),u=0,v=q.start,w=q.end;q.single&&(t=1,w=new Date(v),w.setDate(w.getDate()+1));var x=s-o;p+=x;for(var y in n)n[y]-=x,n[y]<=0&&delete n[y];o=s;for(var y in n){if(y!=u)break;u++}for(var y=0;t>y;y++){var z=u+1;"undefined"==typeof c[p+y]&&(c[p+y]=0),c[p+y]<z&&(c[p+y]=z)}var A=a("<div>").addClass("unselectable").addClass("event").addClass("event-template");q.isStart&&A.addClass("start-line"),q.isEnd&&A.addClass("end-line"),_.bind(this.getEventTemplate(),this)(A,q),a(b).append(A);var B=a(A).outerHeight(),C=2;if(A.css("left","calc("+k*s+"% + 4px)"),A.css("width","calc("+k*t+"% - 7px)"),A.css("margin-top",(B+C)*u),A.attr("cell-index",p),A.attr("pos",u),A.attr("row",d),A.attr("column",s),A.attr("length",t),A.attr("start",_d2s(v)),A.attr("end",i(w)),A.attr("event-id",q.id),h.length<=0)break;n[u]=t}for(var y in c){var D=parseInt(y/this.getColumnCount()),E=y%this.getColumnCount(),u=c[y];if(D>d)break;if(D==d){var F=a("<div>").addClass("unselectable").addClass("event").addClass("ellipsis");a(b).append(F);var B=a(F).outerHeight(),C=2;F.css("left","calc("+k*E+"% + 4px)"),F.css("margin-top",(B+C)*u),F.attr("cell-index",y),F.attr("pos",u),F.attr("row",D),F.attr("column",E),F.attr("length",1),F.hide()}}},this),this.resize()},resize:function(){console.log("res");var b=this.getTarget(),d={},e="",f=b.find(".event");f.show(),_.each(b.find(".event-board .row"),function(b,g){var h=2,i=a(b).height()-21+h;""==e&&(e=a(b).attr("start").toDate());var j=a("<div>").addClass("event").hide();a(b).append(j);var k=j.height()+2;j.remove();var l=Math.floor(i/k);if(0>=l)return void a(b).find(".event").hide();_.each(a(b).find(".ellipsis"),function(b){var c=a(b).outerHeight(),d=2;a(b).css("margin-top",(c+d)*(l-1))});for(var m in c){var n=new Date(e).addDateByDays(parseInt(m));n=n.yyyymmdd("-");var o=f.filter(function(){return a(this).attr("row")==g}).filter(function(){return a(this).attr("start")<=n}).filter(function(){return a(this).attr("end")>n}),p=o.filter(function(){return a(this).attr("pos")>=l});if(p.hide(),_.each(p,function(b,c){var e=parseInt(m);"undefined"==typeof d[e]&&(d[e]=[]),d[e].push(a(b).attr("event-id"))}),c[m]>l){var q=o.filter(function(){return a(this).attr("pos")==l-1});q.hide(),_.each(q,function(b,c){for(var e=parseInt(m),f=a(b).attr("cell-index"),g=f;e>=g;g++)"undefined"==typeof d[g]&&(d[g]=[]),d[g].push(a(b).attr("event-id"))})}else c[m]==l}});var g=b.find(".ellipsis");g.hide();for(var h in d){var i=g.filter(function(){return a(this).attr("cell-index")==h}),j=d[h];j=_.uniq(j,!0),_.bind(this.getEllipsisTemplate(),this)(i,j),i.show()}}}};a(document),a(window),a("body");a.fn.sylendar=new Function,a.fn.sylendar=function(b){var g,i=a(this);g=_.extend({},a.fn.sylendar.defaults,b);var j=(new Date,new a.fn.sylendarObject);if(g.type==h.MONTH){var k=d(g.year,g.month),l=(e(g.year,g.month,k),e(g.year,g.month,1)),m=d(g.year,g.month-1),n=c(g.year,g.month),o=l,p=m-o+1,q=g.month-2,r=g.year,s=new Date(r,q,p),t=new Date(s);if(t.setDate(t.getDate()+7*n),f(j,i,s,t,g.month),""!==g["class"]){var u=g["class"].split(" ");for(var v in u)i.addClass(u[v])}j=_.extend(j,{getTarget:function(){return i},getColumnCount:function(){return 7},getRowCount:function(){return n},getEventTemplate:function(){return g.eventTemplate},getEllipsisTemplate:function(){return g.ellipsisTemplate}})}return j};var n=new Date;a.fn.sylendar.defaults={year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate(),type:h.MONTH,"class":"",eventTemplate:function(a,b){a.text(b.summary)},ellipsisTemplate:function(a,b){a.text()}}});